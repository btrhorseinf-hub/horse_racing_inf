<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è³½é¦¬åƒ¹å€¼æŠ•æ³¨æ¨è–¦</title>
  <style>
    body { font-family: Arial; background: #f5f7fa; color: #333; }
    .card { background: white; border-radius: 10px; padding: 20px; margin: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #e6f2ff; }
    .green { color: green; }
    .red { color: red; }
  </style>
</head>
<body>
  <div style="text-align: center; margin: 30px;">
    <h1>ğŸ‡ è³½é¦¬åƒ¹å€¼æŠ•æ³¨æ¨è–¦</h1>
    <p>Edge > 5% çš„é«˜åƒ¹å€¼é¦¬åŒ¹ï¼ˆæ¨¡å‹é æ¸¬é€²å‰ä¸‰æ©Ÿç‡ vs å¸‚å ´è³ ç‡ï¼‰</p>

    <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
      <div class="card"><b>æ¨è–¦å ´æ¬¡</b><br><span id="race-count">-</span></div>
      <div class="card"><b>ç¸½æ¨è–¦æ•¸</b><br><span id="bet-count">-</span></div>
      <div class="card"><b>å¹³å‡ Edge</b><br><span id="avg-edge">-</span></div>
    </div>

    <table id="bets-table">
      <thead>
        <tr>
          <th>å ´æ¬¡</th>
          <th>é¦¬å</th>
          <th>é¨å¸«</th>
          <th>è³ ç‡</th>
          <th>P(å‰ä¸‰)</th>
          <th>Edge</th>
          <th>æœŸæœ›å ±é…¬</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="refresh()">ğŸ”„ é‡æ–°æ•´ç†æ¨è–¦</button>
    <p style="margin-top: 10px; color: #666;">æœ€å¾Œæ›´æ–°: <span id="last-update"></span></p>
  </div>

  <script>
    async function loadBets() {
      const res = await fetch('/api/bets');
      const data = await res.json();
      
      const tbody = document.querySelector('#bets-table tbody');
      tbody.innerHTML = '';
      
      if (data.status === 'error') {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: red;">âŒ ' + data.message + '</td></tr>';
        return;
      }

      const bets = data.bets;
      document.getElementById('race-count').textContent = new Set(bets.map(b => b.race_name)).size;
      document.getElementById('bet-count').textContent = bets.length;
      document.getElementById('avg-edge').textContent = bets.length > 0 ? 
        (bets.reduce((sum, b) => sum + b.edge, 0) / bets.length).toFixed(2) + '%' : '-';

      bets.forEach(bet => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${bet.race_name}</td>
          <td>${bet.horse_name}</td>
          <td>${bet.jockey}</td>
          <td>${bet.win_odds}</td>
          <td>${bet.predicted_top3_prob}%</td>
          <td class="green">${bet.edge > 0 ? '+' : ''}${bet.edge}%</td>
          <td class="green">${bet.expected_return > 0 ? '+' : ''}${bet.expected_return}%</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById('last-update').textContent = new Date().toLocaleString();
    }

    function refresh() {
      loadBets();
    }

    window.onload = loadBets;
  </script>
</body>
</html>